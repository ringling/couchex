    <!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.15.1">
    <title>Couchex – couchex v0.8.1</title>
    <link rel="stylesheet" href="dist/app-091c05798a.css" />
    
      <link rel="canonical" href="https://hexdocs.pm/couchex/Couchex.html" />
    
    <script src="dist/sidebar_items-19412ce2cd.js"></script>
  </head>
  <body data-type="modules">
    <script>try { if(localStorage.getItem('night-mode')) document.body.className += ' night-mode'; } catch (e) { }</script>

    <div class="main">
<button class="sidebar-toggle">
  <i class="icon-menu"></i>
</button>
<section class="sidebar">

  
  <a href="api-reference.html" class="sidebar-projectLink">
    <div class="sidebar-projectDetails">
      <h1 class="sidebar-projectName">
        couchex
      </h1>
      <h2 class="sidebar-projectVersion">
        v0.8.1
      </h2>
    </div>
    
  </a>

  <div class="sidebar-search">
    <i class="icon-search"></i>
    <input type="text" class="sidebar-searchInput" placeholder="search" autocomplete="off" />
  </div>

  <ul class="sidebar-listNav">
    <li><a id="extras-list" href="#full-list">Pages</a></li>

    
      <li><a id="modules-list" href="#full-list">Modules</a></li>
    

    

    
  </ul>
  <div class="gradient"></div>
  <ul id="full-list" class="sidebar-fullList"></ul>
</section>

<section class="content">
  <div class="content-outer">
    <div id="content" class="content-inner">


      <h1>
        <small class="visible-xs">couchex v0.8.1</small>
        Couchex
        
        
      </h1>

      
        <section id="moduledoc">
          <p>Wrapper around the <a href="https://github.com/benoitc/couchbeam/">couchbeam</a> erlang couchdb client</p>

        </section>
      

      
        <section id="summary" class="details-list">
          <h1 class="section-heading">
            <a class="hover-link" href="#summary">
              <i class="icon-link"></i>
            </a>
            Summary
          </h1>
          

          
  <div class="summary-functions summary">
    <h2>
      <a href="#functions">Functions</a>
    </h2>
    <div class="summary-row">
  <div class="summary-signature">
    <a href="#all/2">all(db, options \\ [:include_docs])</a>
  </div>
  
    <div class="summary-synopsis"><p>Returns all documents in a database</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#all_dbs/1">all_dbs(server)</a>
  </div>
  
    <div class="summary-synopsis"><p>Returns a list of all databases</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#compact/1">compact(db)</a>
  </div>
  
    <div class="summary-synopsis"><p>Compacts a database</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#compact/2">compact(db, design_name)</a>
  </div>
  
    <div class="summary-synopsis"><p>Compacts the view index</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#create_db/3">create_db(server, db_name, options \\ [])</a>
  </div>
  
    <div class="summary-synopsis"><p>Creates a database. The database must NOT exist</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#create_index/2">create_index(db, index)</a>
  </div>
  
    <div class="summary-synopsis"><ul>
<li>CouchDB 2.0 only -
Creates an index
</li>
</ul>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#db_exists?/2">db_exists?(server, db_name)</a>
  </div>
  
    <div class="summary-synopsis"><p>Checks if database exist</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#db_info/1">db_info(db)</a>
  </div>
  
    <div class="summary-synopsis"><p>Returns database info</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#delete_attachment/3">delete_attachment(db, map, attachment_name)</a>
  </div>
  
    <div class="summary-synopsis"><p>Delete attachment from document</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#delete_db/1">delete_db(db)</a>
  </div>
  
    <div class="summary-synopsis"><p>Deletes a database. The database must exist</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#delete_db/2">delete_db(server, db_name)</a>
  </div>
  
    <div class="summary-synopsis"><p>Deletes a database. The database must exist</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#delete_doc/2">delete_doc(db, map)</a>
  </div>
  
    <div class="summary-synopsis"><p>Delete a document</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#delete_docs/2">delete_docs(db, list)</a>
  </div>
  
    <div class="summary-synopsis"><p>Deletes a list of documents</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#doc_exists?/2">doc_exists?(db, doc_id)</a>
  </div>
  
    <div class="summary-synopsis"><p>Returns true if document exists</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#fetch_attachment/3">fetch_attachment(db, doc_id, attachment_name)</a>
  </div>
  
    <div class="summary-synopsis"><p>Fetch attachment from document</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#fetch_view/3">fetch_view(db, arg, options \\ [])</a>
  </div>
  
    <div class="summary-synopsis"><p>Fetch view</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#find/2">find(db, query)</a>
  </div>
  
    <div class="summary-synopsis"><ul>
<li>CouchDB 2.0 only -
Retreives all documents via mango query
</li>
</ul>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#follow/2">follow(db, options \\ [])</a>
  </div>
  
    <div class="summary-synopsis"><p>Follow database changes</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#follow_once/2">follow_once(db, options \\ [])</a>
  </div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#lookup_doc_rev/2">lookup_doc_rev(db, id)</a>
  </div>
  
    <div class="summary-synopsis"><p>Returns current document revision</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#open_db/3">open_db(server, db_name, options \\ [])</a>
  </div>
  
    <div class="summary-synopsis"><p>Opens a database</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#open_doc/2">open_doc(db, map)</a>
  </div>
  
    <div class="summary-synopsis"><p>Retreives document as map, by id with or without revision</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#put_attachment/3">put_attachment(db, map, attachment)</a>
  </div>
  
    <div class="summary-synopsis"><p>Put an attachment to document</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#replicate/2">replicate(server, rep_obj)</a>
  </div>
  
    <div class="summary-synopsis"><p>Replicates a database from source to target</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#save_doc/2">save_doc(db, doc)</a>
  </div>
  
    <div class="summary-synopsis"><p>Save and update a document</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#server_connection/0">server_connection()</a>
  </div>
  
    <div class="summary-synopsis"><p>Returns a server connection</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#server_connection/2">server_connection(url, options \\ [])</a>
  </div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#server_info/1">server_info(server)</a>
  </div>
  
    <div class="summary-synopsis"><p>Returns basic info about server</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#uuid/1">uuid(server)</a>
  </div>
  
    <div class="summary-synopsis"><p>Returns a single server generated uuid</p>
</div>
  
</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#uuids/2">uuids(server, number)</a>
  </div>
  
    <div class="summary-synopsis"><p>Returns a total of <code class="inline">number</code> server generated uuids</p>
</div>
  
</div>

  </div>


          

        </section>
      

      

      
        <section id="functions" class="details-list">
          <h1 class="section-heading">
            <a class="hover-link" href="#functions">
              <i class="icon-link"></i>
            </a>
            Functions
          </h1>
          <div class="detail" id="all/2">
  
    <span id="all/1" />
  
  <div class="detail-header">
    <a href="#all/2" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">all(db, options \\ [:include_docs])</span>
    
    
    
  </div>
  <section class="docstring">
    <p>Returns all documents in a database</p>
<h2 id="all/2-examples" class="section-heading">
  <a href="#all/2-examples" class="hover-link"><i class="icon-link"></i></a>
  Examples
</h2>

<pre><code class="elixir">Couchex.all(db)
#=&gt; [
      %{
        &quot;doc&quot; =&gt; %{&quot;_id&quot; =&gt; &quot;doc_id_1&quot;, &quot;_rev&quot; =&gt; &quot;...&quot;, &quot;foo&quot; =&gt; &quot;bar&quot;},
        &quot;id&quot; =&gt; &quot;doc_id_1&quot;,
        &quot;key&quot; =&gt; &quot;doc_id_1&quot;,
        &quot;value&quot; =&gt; %{&quot;rev&quot; =&gt; &quot;...&quot;}
      },
      %{&quot;doc&quot; =&gt; %{&quot;_id&quot; =&gt; &quot;doc_id_2&quot;, ...
    ]</code></pre>

  </section>
</div>
<div class="detail" id="all_dbs/1">
  
  <div class="detail-header">
    <a href="#all_dbs/1" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">all_dbs(server)</span>
    
    
    
  </div>
  <section class="docstring">
    <p>Returns a list of all databases</p>
<h2 id="all_dbs/1-examples" class="section-heading">
  <a href="#all_dbs/1-examples" class="hover-link"><i class="icon-link"></i></a>
  Examples
</h2>

<pre><code class="elixir">Couchex.all_dbs(server)
#=&gt; {:ok, [&quot;_replicator&quot;, &quot;_users&quot;, &quot;some_db&quot;, ...]}</code></pre>

  </section>
</div>
<div class="detail" id="compact/1">
  
  <div class="detail-header">
    <a href="#compact/1" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">compact(db)</span>
    
    
    
  </div>
  <section class="docstring">
    <p>Compacts a database.</p>
<p><a href="https://wiki.apache.org/couchdb/Compaction">Wiki</a></p>
<h2 id="compact/1-examples" class="section-heading">
  <a href="#compact/1-examples" class="hover-link"><i class="icon-link"></i></a>
  Examples
</h2>

<pre><code class="elixir">{:ok, db} = Couchex.open_db(server, &quot;couchex&quot;)
Couchex.compact(db)
#=&gt; :ok</code></pre>

  </section>
</div>
<div class="detail" id="compact/2">
  
  <div class="detail-header">
    <a href="#compact/2" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">compact(db, design_name)</span>
    
    
    
  </div>
  <section class="docstring">
    <p>Compacts the view index.</p>
<p><a href="https://wiki.apache.org/couchdb/Compaction#View_compaction">Wiki</a></p>
<h2 id="compact/2-examples" class="section-heading">
  <a href="#compact/2-examples" class="hover-link"><i class="icon-link"></i></a>
  Examples
</h2>

<pre><code class="elixir">{:ok, db} = Couchex.open_db(server, &quot;couchex&quot;)
Couchex.compact(db, &quot;design_name&quot;)
#=&gt; :ok</code></pre>

  </section>
</div>
<div class="detail" id="create_db/3">
  
    <span id="create_db/2" />
  
  <div class="detail-header">
    <a href="#create_db/3" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">create_db(server, db_name, options \\ [])</span>
    
    
    
  </div>
  <section class="docstring">
    <p>Creates a database. The database must NOT exist</p>
<h2 id="create_db/3-examples" class="section-heading">
  <a href="#create_db/3-examples" class="hover-link"><i class="icon-link"></i></a>
  Examples
</h2>

<pre><code class="elixir">Couchex.create_db(server, &quot;couchex&quot;)
#=&gt; {:db, server, &quot;couchex&quot;, [basic_auth: {&quot;username&quot;, &quot;password&quot;}]}}
Couchex.create_db(server, &quot;couchex&quot;)
#=&gt; {:error, :db_exists}</code></pre>

  </section>
</div>
<div class="detail" id="create_index/2">
  
  <div class="detail-header">
    <a href="#create_index/2" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">create_index(db, index)</span>
    
    
    
  </div>
  <section class="docstring">
    <ul>
<li>CouchDB 2.0 only -
Creates an index
</li>
</ul>
<h2 id="create_index/2-examples" class="section-heading">
  <a href="#create_index/2-examples" class="hover-link"><i class="icon-link"></i></a>
  Examples
</h2>

<pre><code class="elixir">index = %{ &quot;name&quot; =&gt; &quot;name-index&quot;, &quot;type&quot; =&gt; &quot;json&quot;, &quot;index&quot; =&gt; %{ &quot;fields&quot; =&gt; [ %{ &quot;key&quot;: &quot;asc&quot; } ] } }
Couchex.create_index(db, index)
#=&gt; {:ok, %{id: &quot;id&quot;, name: &quot;name-index&quot;, status: :created}}</code></pre>

  </section>
</div>
<div class="detail" id="db_exists?/2">
  
  <div class="detail-header">
    <a href="#db_exists?/2" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">db_exists?(server, db_name)</span>
    
    
    
  </div>
  <section class="docstring">
    <p>Checks if database exist.</p>
<h2 id="db_exists?/2-examples" class="section-heading">
  <a href="#db_exists?/2-examples" class="hover-link"><i class="icon-link"></i></a>
  Examples
</h2>

<pre><code class="elixir">Couchex.db_exists?(server, &quot;couchex&quot;)
#=&gt; true</code></pre>

  </section>
</div>
<div class="detail" id="db_info/1">
  
  <div class="detail-header">
    <a href="#db_info/1" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">db_info(db)</span>
    
    
    
  </div>
  <section class="docstring">
    <p>Returns database info.</p>
<h2 id="db_info/1-examples" class="section-heading">
  <a href="#db_info/1-examples" class="hover-link"><i class="icon-link"></i></a>
  Examples
</h2>

<pre><code class="elixir">{:ok, db} = Couchex.open_db(server, &quot;couchex&quot;)
Couchex.db_info(db)
#=&gt; %{&quot;committed_update_seq&quot; =&gt; 0, &quot;compact_running&quot; =&gt; false, &quot;data_size&quot; =&gt; 227,
    &quot;db_name&quot; =&gt; &quot;couchex&quot;, &quot;disk_format_version&quot; =&gt; 6, &quot;disk_size&quot; =&gt; 306,
    &quot;doc_count&quot; =&gt; 1, &quot;doc_del_count&quot; =&gt; 0,
    &quot;instance_start_time&quot; =&gt; &quot;1423503379138489&quot;, &quot;purge_seq&quot; =&gt; 0,
    &quot;update_seq&quot; =&gt; 1}</code></pre>

  </section>
</div>
<div class="detail" id="delete_attachment/3">
  
  <div class="detail-header">
    <a href="#delete_attachment/3" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">delete_attachment(db, map, attachment_name)</span>
    
    
    
  </div>
  <section class="docstring">
    <p>Delete attachment from document</p>
<p>This method is idempotent, and will increment the document revision, even though the attachment isn’t present(e.g. already deleted)</p>
<h2 id="delete_attachment/3-examples" class="section-heading">
  <a href="#delete_attachment/3-examples" class="hover-link"><i class="icon-link"></i></a>
  Examples
</h2>

<pre><code class="elixir">attachment_name = &quot;file.txt&quot;

Couchex.delete_attachment(db, %{id: &quot;18c359e463c37525e0ff484dcc0003b7&quot;}, attachment_name)
#=&gt; {:ok, %{&quot;id&quot; =&gt; &quot;18c359e463c37525e0ff484dcc0003b7&quot;, &quot;rev&quot; =&gt; &quot;4-ebe18f0e4f4c3c717a9e9291bc2465b3&quot;}}

Couchex.delete_attachment(db, %{id: &quot;18c359e463c37525e0ff484dcc0003b7&quot;, rev: &quot;3-ebe18f0e4f4c3c717a9e9291bc2465b3&quot;}, attachment_name)
#=&gt; {:ok, %{&quot;id&quot; =&gt; &quot;18c359e463c37525e0ff484dcc0003b7&quot;, &quot;rev&quot; =&gt; &quot;4-ebe18f0e4f4c3c717a9e9291bc2465b3&quot;}}</code></pre>

  </section>
</div>
<div class="detail" id="delete_db/1">
  
  <div class="detail-header">
    <a href="#delete_db/1" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">delete_db(db)</span>
    
    
    
  </div>
  <section class="docstring">
    <p>Deletes a database. The database must exist</p>
<h2 id="delete_db/1-examples" class="section-heading">
  <a href="#delete_db/1-examples" class="hover-link"><i class="icon-link"></i></a>
  Examples
</h2>

<pre><code class="elixir">{:ok, db} = Couchex.open_db(server, &quot;couchex&quot;)
#=&gt; {:ok, {:db, server, &quot;couchex&quot;, []}}
Couchex.delete_db(db)
#=&gt; {:ok, :db_deleted}
Couchex.delete_db(db)
#=&gt; {:error, :not_found}</code></pre>

  </section>
</div>
<div class="detail" id="delete_db/2">
  
  <div class="detail-header">
    <a href="#delete_db/2" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">delete_db(server, db_name)</span>
    
    
    
  </div>
  <section class="docstring">
    <p>Deletes a database. The database must exist</p>
<h2 id="delete_db/2-examples" class="section-heading">
  <a href="#delete_db/2-examples" class="hover-link"><i class="icon-link"></i></a>
  Examples
</h2>

<pre><code class="elixir">Couchex.delete_db(server, &quot;couchex&quot;)
#=&gt; {:ok, :db_deleted}
Couchex.delete_db(server, &quot;couchex&quot;)
#=&gt; {:error, :not_found}</code></pre>

  </section>
</div>
<div class="detail" id="delete_doc/2">
  
  <div class="detail-header">
    <a href="#delete_doc/2" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">delete_doc(db, map)</span>
    
    
    
  </div>
  <section class="docstring">
    <p>Delete a document</p>
<h2 id="delete_doc/2-examples" class="section-heading">
  <a href="#delete_doc/2-examples" class="hover-link"><i class="icon-link"></i></a>
  Examples
</h2>

<pre><code class="elixir">Couchex.delete_doc(db, %{id: &quot;18c359e463c37525e0ff484dcc0003b7&quot;, rev: &quot;1-59414e77c768bc202142ac82c2f129de&quot;})
#=&gt; %{&quot;id&quot; =&gt; &quot;18c359e463c37525e0ff484dcc0003b7&quot;, &quot;ok&quot; =&gt; true, &quot;rev&quot; =&gt; &quot;2-9b2e3bcc3752a3a952a3570b2ed4d27e&quot;}</code></pre>

  </section>
</div>
<div class="detail" id="delete_docs/2">
  
  <div class="detail-header">
    <a href="#delete_docs/2" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">delete_docs(db, list)</span>
    
    
    
  </div>
  <section class="docstring">
    <p>Deletes a list of documents</p>
<h2 id="delete_docs/2-examples" class="section-heading">
  <a href="#delete_docs/2-examples" class="hover-link"><i class="icon-link"></i></a>
  Examples
</h2>

<pre><code class="elixir">Couchex.delete_docs(db, [%{id: &quot;18c359e463c37525e0ff484dcc0003b7&quot;, rev: &quot;1-59414e77c768bc202142ac82c2f129de&quot;}])
#=&gt; [%{&quot;id&quot; =&gt; &quot;18c359e463c37525e0ff484dcc0003b7&quot;, &quot;ok&quot; =&gt; true, &quot;rev&quot; =&gt; &quot;2-9b2e3bcc3752a3a952a3570b2ed4d27e&quot;}]</code></pre>

  </section>
</div>
<div class="detail" id="doc_exists?/2">
  
  <div class="detail-header">
    <a href="#doc_exists?/2" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">doc_exists?(db, doc_id)</span>
    
    
    
  </div>
  <section class="docstring">
    <p>Returns true if document exists</p>
<h2 id="doc_exists?/2-examples" class="section-heading">
  <a href="#doc_exists?/2-examples" class="hover-link"><i class="icon-link"></i></a>
  Examples
</h2>

<pre><code class="elixir">Couchex.doc_exists?(db, &quot;EXISTING_DOC_ID&quot;)
#=&gt; true

Couchex.doc_exists?(db, &quot;NONE_EXISTING_DOC_ID&quot;)
#=&gt; false</code></pre>

  </section>
</div>
<div class="detail" id="fetch_attachment/3">
  
  <div class="detail-header">
    <a href="#fetch_attachment/3" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">fetch_attachment(db, doc_id, attachment_name)</span>
    
    
    
  </div>
  <section class="docstring">
    <p>Fetch attachment from document</p>
<h2 id="fetch_attachment/3-examples" class="section-heading">
  <a href="#fetch_attachment/3-examples" class="hover-link"><i class="icon-link"></i></a>
  Examples
</h2>

<pre><code class="elixir">doc_id = &quot;18c359e463c37525e0ff484dcc0003b7&quot;
attachment_name = &quot;file.txt&quot;
Couchex.fetch_attachment(db, doc_id, attachment_name)
#=&gt; {:ok, &quot;SOME DATA - HERE IT&#39;S TEXT&quot;}</code></pre>

  </section>
</div>
<div class="detail" id="fetch_view/3">
  
    <span id="fetch_view/2" />
  
  <div class="detail-header">
    <a href="#fetch_view/3" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">fetch_view(db, arg, options \\ [])</span>
    
    
    
  </div>
  <section class="docstring">
    <p>Fetch view</p>
<h2 id="fetch_view/3-examples" class="section-heading">
  <a href="#fetch_view/3-examples" class="hover-link"><i class="icon-link"></i></a>
  Examples
</h2>

<pre><code class="elixir">{:ok, res} = Couchex.fetch_view(db, {&quot;lists&quot;,&quot;company_users_by_income&quot;},[:group])

When having a design doc like this,

design_doc = %{
   &quot;_id&quot; =&gt; &quot;_design/lists&quot;,
   &quot;language&quot;: &quot;javascript&quot;,
   &quot;views&quot;: %{
       &quot;by_customer_id&quot;: %{
           &quot;map&quot;: &quot;function(doc) {  emit(doc.customer_id, doc);}&quot;
       }
   }
}

fetch docs by customer id

{:ok, res} = Couchex.fetch_view(db, {&quot;lists&quot;,&quot;by_customer_id&quot;},[key: customer_id])</code></pre>

  </section>
</div>
<div class="detail" id="find/2">
  
  <div class="detail-header">
    <a href="#find/2" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">find(db, query)</span>
    
    
    
  </div>
  <section class="docstring">
    <ul>
<li>CouchDB 2.0 only -
Retreives all documents via mango query
</li>
</ul>
<h2 id="find/2-examples" class="section-heading">
  <a href="#find/2-examples" class="hover-link"><i class="icon-link"></i></a>
  Examples
</h2>

<pre><code class="elixir">query = %{
  &quot;selector&quot;: %{
    &quot;_id&quot;: %{
      &quot;$gt&quot;: nil
    }
  }
}
Couchex.find(db, query)
#=&gt; %{ docs: [%{&quot;_id&quot; =&gt; &quot;...&quot;}, ...], warning: &lt;ONLY IF WARNING SENT FROM SERVER&gt; }</code></pre>

  </section>
</div>
<div class="detail" id="follow/2">
  
    <span id="follow/1" />
  
  <div class="detail-header">
    <a href="#follow/2" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">follow(db, options \\ [])</span>
    
    
    
  </div>
  <section class="docstring">
    <p>Follow database changes</p>
<h2 id="follow/2-examples" class="section-heading">
  <a href="#follow/2-examples" class="hover-link"><i class="icon-link"></i></a>
  Examples
</h2>

<pre><code class="elixir">def changes_fun(stream_ref) do
  receive do
    {stream_ref, {:done, last_seq}} -&gt;
      Logger.info &quot;Stopped at seq: #{inspect last_seq}&quot;
      :ok
    {stream_ref, {:change, change}} -&gt;
      Logger.info &quot;Change: #{inspect change}&quot;
      changes_fun(stream_ref)
    {stream_ref, error}-&gt;
      Log.error &quot;#{inspect error}&quot;
    msg -&gt;
      Logger.warn &quot;#{inspect msg}&quot;
  end
end

Couchex.follow(db, [:continuous, :heartbeat])
#=&gt; {:ok, &lt;stream_ref&gt;}
changes_fun(&lt;stream_ref&gt;)</code></pre>

  </section>
</div>
<div class="detail" id="follow_once/2">
  
    <span id="follow_once/1" />
  
  <div class="detail-header">
    <a href="#follow_once/2" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">follow_once(db, options \\ [])</span>
    
    
    
  </div>
  <section class="docstring">
    
  </section>
</div>
<div class="detail" id="lookup_doc_rev/2">
  
  <div class="detail-header">
    <a href="#lookup_doc_rev/2" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">lookup_doc_rev(db, id)</span>
    
    
    
  </div>
  <section class="docstring">
    <p>Returns current document revision</p>
<h2 id="lookup_doc_rev/2-examples" class="section-heading">
  <a href="#lookup_doc_rev/2-examples" class="hover-link"><i class="icon-link"></i></a>
  Examples
</h2>

<pre><code class="elixir">Couchex.lookup_doc_rev(db, &quot;18c359e463c37525e0ff484dcc0003b7&quot;)
#=&gt; {:ok, &quot;1-59414e77c768bc202142ac82c2f129de&quot;}</code></pre>

  </section>
</div>
<div class="detail" id="open_db/3">
  
    <span id="open_db/2" />
  
  <div class="detail-header">
    <a href="#open_db/3" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">open_db(server, db_name, options \\ [])</span>
    
    
    
  </div>
  <section class="docstring">
    <p>Opens a database</p>
<p>If credentials were passed during server_connection, they will be passed on to open_db.
They will however be overwritten by the credentials applied to open_db</p>
<h2 id="open_db/3-examples" class="section-heading">
  <a href="#open_db/3-examples" class="hover-link"><i class="icon-link"></i></a>
  Examples
</h2>

<pre><code class="elixir">Couchex.open_db(server, &quot;couchex&quot;)
#=&gt; {:ok, {:db, server, &quot;couchex&quot;, []}}

Couchex.open_db(server, &quot;couchex&quot;, [{:basic_auth, {&quot;username&quot;, &quot;password&quot;}}])
#=&gt; {:ok, {:db, server, &quot;couchex&quot;, [{:basic_auth, {&quot;username&quot;, &quot;password&quot;}}]}}</code></pre>

  </section>
</div>
<div class="detail" id="open_doc/2">
  
  <div class="detail-header">
    <a href="#open_doc/2" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">open_doc(db, map)</span>
    
    
    
  </div>
  <section class="docstring">
    <p>Retreives document as map, by id with or without revision</p>
<h2 id="open_doc/2-examples" class="section-heading">
  <a href="#open_doc/2-examples" class="hover-link"><i class="icon-link"></i></a>
  Examples
</h2>

<pre><code class="elixir">Couchex.open_doc(db, %{id: id})
#=&gt; {:ok, %{&quot;_id&quot; =&gt; id, &quot;_rev&quot; =&gt; rev, ...}}

Couchex.open_doc(db, %{id: id, rev: revision})
#=&gt; {:ok, %{&quot;_id&quot; =&gt; id, &quot;_rev&quot; =&gt; rev, ...}}</code></pre>

  </section>
</div>
<div class="detail" id="put_attachment/3">
  
  <div class="detail-header">
    <a href="#put_attachment/3" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">put_attachment(db, map, attachment)</span>
    
    
    
  </div>
  <section class="docstring">
    <p>Put an attachment to document</p>
<h2 id="put_attachment/3-examples" class="section-heading">
  <a href="#put_attachment/3-examples" class="hover-link"><i class="icon-link"></i></a>
  Examples
</h2>

<pre><code class="elixir">attachment = %{ name: &quot;image.png&quot;, data: &quot;....&quot;, content_type: &quot;image/png&quot; }
Couchex.put_attachment(db, %{id: id}, attachment) # latest revision
#=&gt; {:ok, %{&quot;id&quot; =&gt; &quot;18c359e463c37525e0ff484dcc0003b7&quot;, &quot;rev&quot; =&gt; &quot;3-ebe18f0e4f4c3c717a9e9291bc2465b3&quot;}}

doc_id = &quot;18c359e463c37525e0ff484dcc0003b7&quot;
revision = &quot;1-59414e77c768bc202142ac82c2f129de&quot;
content_type = Couchex.MIME.type(&quot;txt&quot;) # =&gt; &quot;text/plain&quot;
attachment = %{ name: &quot;file.txt&quot;, data: &quot;SOME DATA - HERE IT&#39;S TEXT&quot;, content_type: content_type }
Couchex.put_attachment(db, %{id: doc_id, rev: revision}, attachment)
#=&gt; {:ok, %{&quot;id&quot; =&gt; &quot;18c359e463c37525e0ff484dcc0003b7&quot;, &quot;rev&quot; =&gt; &quot;3-ebe18f0e4f4c3c717a9e9291bc2465b3&quot;}}</code></pre>

  </section>
</div>
<div class="detail" id="replicate/2">
  
  <div class="detail-header">
    <a href="#replicate/2" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">replicate(server, rep_obj)</span>
    
    
    
  </div>
  <section class="docstring">
    <p>Replicates a database from source to target</p>
<h2 id="replicate/2-examples" class="section-heading">
  <a href="#replicate/2-examples" class="hover-link"><i class="icon-link"></i></a>
  Examples
</h2>

<p><code class="inline">create_target</code> param, target db is created if not already present</p>
<p><code class="inline">continuous</code> param, replication runs continuously until server restart</p>
<pre><code class="elixir">Couchex.replicate(server, %{source: &quot;sourcedb&quot;, target: &quot;targetdb&quot;, create_target: true})
#=&gt; {:ok, %{&quot;history&quot; =&gt; [...], &quot;ok&quot; =&gt; true, &quot;replication_id_version&quot; =&gt; 3, &quot;session_id&quot; =&gt; &quot;b3457b342b2eb31ea0f85e77bac03a66&quot;, &quot;source_last_seq&quot; =&gt; 16}}

Couchex.replicate(server, %{source: &quot;https://user:pass@sourcedb&quot;, target: &quot;targetdb&quot;, create_target: true})
#=&gt; {:ok, resp}

Couchex.replicate(server, %{source: &quot;https://user:pass@sourcedb&quot;, target: &quot;http://user:pass@targetdb&quot;, create_target: true})
#=&gt; {:ok, resp}

Couchex.replicate(server, %{source: &quot;https://user:pass@sourcedb&quot;, target: &quot;http://user:pass@targetdb&quot;, create_target: true, continuous: true})
#=&gt; #=&gt; {:ok, %{&quot;Cache-Control&quot; =&gt; &quot;must-revalidate&quot;, &quot;Content-Length&quot; =&gt; &quot;84&quot;, &quot;Content-Type&quot; =&gt; &quot;application/json&quot;, &quot;Date&quot; =&gt; &quot;Mon, 09 Feb 2015 16:24:19 GMT&quot;, &quot;Server&quot; =&gt; &quot;CouchDB/1.5.0 (Erlang OTP/R16B03)&quot;}}</code></pre>

  </section>
</div>
<div class="detail" id="save_doc/2">
  
  <div class="detail-header">
    <a href="#save_doc/2" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">save_doc(db, doc)</span>
    
    
    
  </div>
  <section class="docstring">
    <p>Save and update a document</p>
<p>Update a document, by using an existing document id</p>
<p>Please remark the use of <code class="inline">%{&quot;_id&quot; =&gt; &quot;ID&quot;, ...}</code> and not <code class="inline">%{&quot;_id&quot;: &quot;ID&quot;, ...}</code>, the latter will not work</p>
<h2 id="save_doc/2-examples" class="section-heading">
  <a href="#save_doc/2-examples" class="hover-link"><i class="icon-link"></i></a>
  Examples
</h2>

<pre><code class="elixir">Couchex.save_doc(db, %{&quot;key&quot; =&gt; &quot;value&quot;}) # Couch auto creates id
#=&gt; %{&quot;_id&quot; =&gt; &quot;c1cdba4b7d7a963b9ca7c5445684679f&quot;, &quot;_rev&quot; =&gt; &quot;1-59414e77c768bc202142ac82c2f129de&quot;, &quot;key&quot; =&gt; &quot;value&quot;}

Couchex.save_doc(db, %{&quot;_id&quot; =&gt; &quot;FIRST_ID&quot;, &quot;key&quot; =&gt; &quot;value&quot;}) # User defined id
#=&gt; %{&quot;_id&quot; =&gt; &quot;FIRST_ID&quot;, &quot;_rev&quot; =&gt; &quot;1-59414e77c768bc202142ac82c2f129de&quot;, &quot;key&quot; =&gt; &quot;value&quot;}</code></pre>

  </section>
</div>
<div class="detail" id="server_connection/0">
  
  <div class="detail-header">
    <a href="#server_connection/0" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">server_connection()</span>
    
    
    
  </div>
  <section class="docstring">
    <p>Returns a server connection</p>
<h2 id="server_connection/0-examples" class="section-heading">
  <a href="#server_connection/0-examples" class="hover-link"><i class="icon-link"></i></a>
  Examples
</h2>

<pre><code class="elixir">Couchex.server_connection(&quot;url&quot;)
#=&gt; {:server, &quot;url&quot;, []}

Couchex.server_connection(@couchdb_url, [{:basic_auth, {&quot;username&quot;, &quot;password&quot;}}])
#=&gt; {:server, &quot;url&quot;, [{:basic_auth, {&quot;username&quot;, &quot;password&quot;}}]}</code></pre>

  </section>
</div>
<div class="detail" id="server_connection/2">
  
    <span id="server_connection/1" />
  
  <div class="detail-header">
    <a href="#server_connection/2" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">server_connection(url, options \\ [])</span>
    
    
    
  </div>
  <section class="docstring">
    
  </section>
</div>
<div class="detail" id="server_info/1">
  
  <div class="detail-header">
    <a href="#server_info/1" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">server_info(server)</span>
    
    
    
  </div>
  <section class="docstring">
    <p>Returns basic info about server</p>
<h2 id="server_info/1-examples" class="section-heading">
  <a href="#server_info/1-examples" class="hover-link"><i class="icon-link"></i></a>
  Examples
</h2>

<pre><code class="elixir">Couchex.server_info(server)
#=&gt; %{&quot;couchdb&quot; =&gt; &quot;Welcome&quot;, &quot;uuid&quot; =&gt; &quot;c1cdba4b7d7a963b9ca7c5445684679f&quot;, &quot;vendor&quot; =&gt; {[{&quot;version&quot;, &quot;1.5.0-1&quot;}, {&quot;name&quot;, &quot;Homebrew&quot;}]}, &quot;version&quot; =&gt; &quot;1.5.0&quot;}</code></pre>

  </section>
</div>
<div class="detail" id="uuid/1">
  
  <div class="detail-header">
    <a href="#uuid/1" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">uuid(server)</span>
    
    
    
  </div>
  <section class="docstring">
    <p>Returns a single server generated uuid</p>
<h2 id="uuid/1-examples" class="section-heading">
  <a href="#uuid/1-examples" class="hover-link"><i class="icon-link"></i></a>
  Examples
</h2>

<pre><code class="elixir">Couchex.uuid(server)
#=&gt; &quot;267732468d85b6fd22504aeaa4dc68e3&quot;</code></pre>

  </section>
</div>
<div class="detail" id="uuids/2">
  
  <div class="detail-header">
    <a href="#uuids/2" class="detail-link" title="Link to this function">
      <i class="icon-link"></i>
    </a>
    <span class="signature">uuids(server, number)</span>
    
    
    
  </div>
  <section class="docstring">
    <p>Returns a total of <code class="inline">number</code> server generated uuids</p>
<h2 id="uuids/2-examples" class="section-heading">
  <a href="#uuids/2-examples" class="hover-link"><i class="icon-link"></i></a>
  Examples
</h2>

<pre><code class="elixir">Couchex.uuids(server, 3)
#=&gt; [&quot;267732468d85b6fd22504aeaa4fb8ac9&quot;, &quot;267732468d85b6fd22504aeaa4fb8065&quot;, &quot;267732468d85b6fd22504aeaa4fb7ca7&quot;]</code></pre>

  </section>
</div>

        </section>
      

      
          <footer class="footer">
        <p>
          <span class="line">
            Built using
            <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" rel="help" target="_blank">ExDoc</a> (v0.15.1),
          </span>
          <span class="line">
            designed by
            <a href="https://twitter.com/dignifiedquire" target="_blank" title="@dignifiedquire">Friedel Ziegelmayer</a>.
            </span>
        </p>
        <button class="night-mode-toggle" />
      </footer>
    </div>
  </div>
</section>
</div>
  <script src="dist/app-574613960f.js"></script>
  </body>
</html>

